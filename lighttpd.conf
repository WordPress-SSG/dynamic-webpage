server.modules = (
    "mod_accesslog",
    "mod_access",
    "mod_alias",
    "mod_compress",
    "mod_deflate",
    "mod_redirect",
    "mod_rewrite",
    "mod_fastcgi"
)

server.document-root = "/var/www/html"
server.port = 80
server.bind = "0.0.0.0"  # Allow listening on all interfaces

server.username = "www-data"
server.groupname = "www-data"

server.indexfiles = ("index.php", "index.html", "index.htm")

# Enable URL rewriting for WordPress permalinks
url.rewrite-if-not-file = (
    "^/wp-admin$" => "/wp-admin/",
    "^/(.*)/$" => "/$1",
    "^/([^.]+)$" => "/index.php?q=$1"
)

# PHP-FPM FastCGI configuration
fastcgi.server = (
    ".php" => (
        "localhost" => (
            "socket" => "/run/php/php8.2-fpm.sock",
            "broken-scriptfilename" => "enable"
        )
    )
)

deflate.cache-dir = "/var/cache/lighttpd/compress/"
# Enable gzip compression
deflate.mimetypes = (
    "text/plain",
    "text/css",
    "text/javascript",
    "application/javascript",
    "application/json",
    "application/x-javascript",
    "application/xml"
)

# Deny access to hidden files and sensitive directories
$HTTP["url"] =~ "^/(\.|wp-config.php)" {
    url.access-deny = ("")
}

# Log files
accesslog.filename = "/var/log/lighttpd/access.log"
server.errorlog = "/var/log/lighttpd/error.log"

# Enable debugging if needed
# server.debug-logfile = "/var/log/lighttpd/debug.log"
# debug.log-request-handling = "enable"
